<div class="container">
  <nav class="navbar navbar-expand-sm fixed-top navbar-light bg-light">
    <alert type="info" *ngIf="totalSuccessCount > 0 || totalFailCount > 0">
      <strong *ngIf="totalSuccessCount > 0"
        >{{ totalSuccessCount }} Observation(s) submitted Successfully.
      </strong>
      <strong *ngIf="totalFailCount > 0"
        >{{ totalFailCount }} Observation(s) failed to Submit
      </strong>
    </alert>
    <div class="col-6 col-md-6 date-label">
      <b>Date Retrieved </b> : {{ now | date: "yyyy-MM-dd HH:mm" }}
    </div>
    <div class="col-6 col-md-6 pull-right">
      <button
        type="button"
        class="btn btn-primary btn-sm pull-right"
        (click)="toggleAllObservations()"
      >
        {{ toggleAll == false ? "HideAll" : "ExpandAll" }}
      </button>
    </div>
  </nav>

  <div class="panel-body table-wrapper-scroll-y my-custom-scrollbar">
    <div *ngFor="let key of keys; let i = index" class="table-responsive">
      <div>
        <div class="col-md-6">{{ codes[key].text }}</div>
        <div class="col-md-3">
          Count : {{ codes[key].matchingEntries.length }}
        </div>
        <div class="col-md-2 form-group">
          <button
            type="button"
            class="btn btn-primary pull-right"
            (click)="toggleObservations(i)"
          >
            {{ toggle[i] == true ? "Hide" : "Show" }}
          </button>
        </div>
      </div>

      <table
        class="table table-striped table-bordered table-hover"
        *ngIf="toggle[i]"
      >
        <thead>
          <td><b>Effective Time</b></td>
          <td><b>Value</b></td>
          <td>
            <input
              class="checkbox i-checks"
              type="checkbox"
              (ngModelChange)="selectAll(key)"
              [(ngModel)]="codes[key].isAllSelected"
              [disabled]="codes[key].isAlldisabled"
            />
          </td>
        </thead>
        <tbody>
          <tr
            *ngFor="let entry of codes[key].matchingEntries"
            [style.fontWeight]="entry.state"
          >
            <td>
              {{
                entry.resource.effectiveDateTime | date: "yyyy-MM-dd HH:mm:ssZ"
              }}
            </td>
            <td>
              {{ resourcevalue(entry) }}
            </td>
            <td>
              <input
                class="checkbox i-checks"
                type="checkbox"
                [(ngModel)]="entry.selected"
                (ngModelChange)="toggleOption(key)"
                [disabled]="entry.state == 'lighter'"
              />
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="row top-buffer navbar fixed-bottom">
    <div class="col-md-12">
      <button
        type="button"
        class="btn btn-primary pull-right"
        (click)="submitToCibmtr()"
        enabled
      >
        Submit to CIBMTR
      </button>
    </div>
  </div>
</div>
